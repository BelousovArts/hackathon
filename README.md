# PCD Viewer - Инструмент для семантической сегментации облаков точек

Приложение для визуализации и анализа облаков точек с использованием нейросетевых моделей семантической сегментации.

## Описание проекта

PCD Viewer - это desktop-приложение с графическим интерфейсом для работы с облаками точек (point clouds). Приложение позволяет:

- **Импортировать** облака точек в форматах `.pcd`, `.ply`, `.bin`
- **Визуализировать** 3D данные с различными режимами отображения
- **Анализировать** облака точек с помощью нейросетевых моделей (RandLA-Net)
- **Редактировать** результаты сегментации вручную
- **Экспортировать** обработанные данные

## Возможности

### Визуализация
- Различные режимы окраски: градиент по высоте, RGB, интенсивность, классы сегментации
- Настройка размера точек, цвета фона, режима проекции
- Eye Dome Lighting для лучшего восприятия глубины
- Стандартные виды (спереди, сзади, сверху, снизу, слева, справа)

### Сегментация
Приложение включает три предобученные модели RandLA-Net:

1. **RandLA-Net (Hack2C)** - 2 класса: Background, Car
2. **RandLA-Net (Toronto3D)** - 8 классов: Road, Road marking, Natural, Building, Utility line, Pole, Car, Fence
3. **RandLA-Net (SemanticKITTI)** - 19 классов дорожной сцены

### Редактирование
- Ручное выделение точек (точечное и кистью)
- Изменение класса выделенных точек
- Удаление точек по классам
- Интерполяция областей

## Структура проекта

```
hackathon/
├── README.md              # Этот файл
├── requirements.txt       # Зависимости Python
├── run.py                # Скрипт запуска приложения
├── ui/                   # Исходный код приложения
│   ├── MainWindow.py     # Сгенерированный UI код
│   └── PCDViewer.py      # Основная логика приложения
├── configs/              # Конфигурации моделей
│   ├── randlanet_hack2c.yml
│   ├── randlanet_toronto3d.yml
│   └── randlanet_semantickitti.yml
├── models/               # Веса нейросетей
│   ├── randlanet_hack2c.pth (2 класса)
│   ├── randlanet_toronto3d.pth (8 классов)
│   └── randlanet_semantickitti.pth (19 классов)
└── data/          # Пример данных
    └── points.pcd
```

## Требования

### Системные требования
- **OS**: Linux (рекомендуется Ubuntu 20.04+)
- **Python**: 3.10.8 (строго рекомендуется)
- **GPU**: NVIDIA GPU с поддержкой CUDA (рекомендуется для инференса)
- **RAM**: минимум 8 GB
- **Диск**: ~2 GB для моделей и зависимостей

### Программные зависимости
Основные библиотеки:
- PyQt5 - графический интерфейс
- PyVista - 3D визуализация
- Open3D - работа с облаками точек
- PyTorch - нейросетевой инференс
- NumPy, SciPy - вычисления

Полный список см. в `requirements.txt`

**Важно**: Проект использует Open3D-ML для нейросетевых моделей. Этот модуль устанавливается автоматически из GitHub при выполнении `pip install -r requirements.txt`.

## Установка

### 1. Клонирование/распаковка проекта

```bash
# Если это архив, распакуйте его:
# unzip hackathon.zip
# cd hackathon

# Или клонируйте репозиторий:
git clone <repository_url>
cd hackathon
```

### 2. Создание виртуального окружения

Рекомендуется использовать виртуальное окружение Python:

```bash
# Создание виртуального окружения
python3 -m venv venv

# Активация виртуального окружения
source venv/bin/activate
```

### 3. Установка зависимостей

#### Вариант A: С поддержкой CUDA (рекомендуется)

Если у вас есть NVIDIA GPU и установлена CUDA:

```bash
# Установка PyTorch 2.2.2 с CUDA 11.8 (требуется для Open3D-ML!)
pip install torch==2.2.2 torchvision==0.17.2 torchaudio==2.2.2 --index-url https://download.pytorch.org/whl/cu118

# Установка остальных зависимостей
pip install -r requirements.txt
```

#### Вариант B: Только CPU

Если GPU нет или CUDA не установлена:

```bash
# Установка PyTorch 2.2.2 CPU-версии (требуется для Open3D-ML!)
pip install torch==2.2.2 torchvision==0.17.2 torchaudio==2.2.2 --index-url https://download.pytorch.org/whl/cpu

# Установка остальных зависимостей
pip install -r requirements.txt
```

**Примечание**: На CPU инференс будет значительно медленнее (несколько минут на облако).

### 4. Проверка установки

Сначала проверьте версию Python:

```bash
python3 --version
# Должна быть: Python 3.10.8
```

Затем проверьте, что все основные модули импортируются:

```bash
python3 -c "import torch; import open3d; import pyvista; print('OK')"
```

Если команда вывела `OK`, установка прошла успешно.

## Запуск приложения

### Базовый запуск

```bash
# Убедитесь, что виртуальное окружение активировано
source venv/bin/activate

# Запуск приложения
python3 run.py
```

### Первый запуск

При первом запуске:
1. Откроется главное окно приложения
2. Нажмите кнопку **"Импорт"** в левой панели
3. Выберите файл облака точек (например, `data/points.pcd`)
4. Облако отобразится в 3D-окне

## Использование

### Импорт облака точек

1. Кнопка **"Импорт"** → выбрать файл `.pcd`, `.ply` или `.bin`
2. Облако появится в списке слева и отобразится в 3D-окне

### Анализ нейросетью

1. Выберите облако в списке (левая панель)
2. В выпадающем списке выберите модель:
   - **RandLA-Net** - для детекции автомобилей (Hack2C)
   - **RandLA-Net (Toronto3D)** - для городских сцен
   - **RandLA-Net (SemanticKITTI)** - для дорожных сцен
3. Нажмите кнопку **"Анализ"**
4. Дождитесь окончания инференса (10-60 секунд в зависимости от размера облака и GPU)
5. Результат отобразится цветами классов

### Визуализация

**Режимы окраски** (правая панель, вкладка "Отображение"):
- **Градиент по высоте** - от синего (низ) к красному (верх)
- **RGB** - исходные цвета (если есть)
- **Интенсивность** - интенсивность отражения лазера
- **Label** - аннотированные классы
- **Predict** - результат нейросети
- Одноцветные: Белый, Черный, Синий, Серый

**Управление камерой**:
- **Левая кнопка мыши** - вращение
- **Средняя кнопка мыши** - панорама
- **Колесико мыши** - масштабирование
- Кнопки **Front/Back/Left/Right/Top/Bottom** - стандартные виды
- **Reset** - сброс камеры

### Редактирование

**Выделение точек**:
- Кнопка **"Точка"** - режим точечного выделения (правая кнопка мыши по точке)
- Кнопка **"Кисть"** - режим выделения кистью (правая кнопка мыши, Alt+ПКМ для снятия)
- Кнопки **+/-** - изменение размера кисти

**Операции**:
- **Преобразовать** - изменить класс выделенных точек
- **Удалить** - удалить точки выбранного класса
- Контекстное меню (правая кнопка на облаке в списке):
  - Очистить выделение
  - Удалить выделенные точки
  - Интерполировать область

### Экспорт результатов

1. Выберите облако в списке
2. Выберите формат экспорта (`.pcd` или `.ply`)
3. Нажмите **"Экспорт"**
4. Укажите путь для сохранения файла

Экспортируются все атрибуты: координаты, цвета, интенсивность, label, predict.

## Технические детали

### Архитектура моделей

**RandLA-Net** (Random Sampling and Local Feature Aggregation Network):
- Эффективная архитектура для семантической сегментации больших облаков точек
- Использует random sampling для обработки миллионов точек
- Local feature aggregation для сохранения геометрических деталей

### Формат данных

Приложение работает с тремя форматами:
- **PCD** (Point Cloud Data) - формат Open3D/PCL
- **PLY** (Polygon File Format) - универсальный формат
- **BIN** (KITTI Binary) - бинарный формат KITTI dataset

### Производительность

Типичное время инференса (на примере GPU NVIDIA RTX 3090):
- 100K точек: ~10-15 секунд
- 500K точек: ~30-40 секунд
- 1M точек: ~60-90 секунд

На CPU время увеличивается в 10-20 раз.

## Решение проблем

### Неправильная версия Python

Убедитесь, что используется Python 3.10.8:

```bash
python3 --version
```

Если версия отличается, установите Python 3.10.8:

```bash
# Добавление репозитория deadsnakes (для Ubuntu)
sudo add-apt-repository ppa:deadsnakes/ppa
sudo apt update
sudo apt install python3.10

# Проверка версии
python3.10 --version
```

Используйте `python3.10` вместо `python3` для создания виртуального окружения:

```bash
python3.10 -m venv venv
source venv/bin/activate
```

### Ошибка "No module named 'PyQt5'"

```bash
pip install PyQt5
```

### Ошибка "Could not load OpenGL"

Убедитесь, что установлены драйверы GPU и библиотеки OpenGL:

```bash
sudo apt-get install libgl1-mesa-glx libglu1-mesa
```

### Ошибка "CUDA out of memory"

- Уменьшите размер облака точек или используйте подвыборку
- Закройте другие приложения, использующие GPU
- Используйте CPU-версию PyTorch (инференс будет медленнее)

### Инференс очень медленный

- Убедитесь, что используется GPU-версия PyTorch
- Проверьте, что CUDA работает: `python3 -c "import torch; print(torch.cuda.is_available())"`
- Если вывод `False`, переустановите PyTorch с CUDA

### Приложение не запускается

1. Проверьте версию Python: `python3 --version` (должна быть >= 3.8)
2. Проверьте, что виртуальное окружение активировано
3. Переустановите зависимости: `pip install -r requirements.txt --force-reinstall`
